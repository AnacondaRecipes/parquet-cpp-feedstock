{% set version = "1.5.0" %}
{% set sha256sum = "91720212f37a7131d047eb7cc259fce6ff9a0daac2ad7c9d04f945c0a0c2dca6" %}

# NOTE(wesm): When updating the build, please remember also to update the
# pinned Arrow version. We are letting parquet-cpp build its own Apache Arrow
# so that we do not have to update conda-packages for Arrow before we can
# update this package. So if there is an ABI change in Arrow, we can update
# this package faster

package:
  name: parquet-cpp
  version: {{ version }}

source:
  url: https://github.com/apache/parquet-cpp/archive/apache-parquet-cpp-{{version}}.tar.gz
  sha256: {{ sha256sum }}

build:
  number: 0
  skip: true  # [win and not (vc>=14 and win64)]
  run_exports:
    - {{ pin_subpackage("parquet-cpp", max_pin="x.x") }}

requirements:
  build:
    - {{ compiler("c") }}
    - {{ compiler("cxx") }}
    - cmake
    - make      # [unix]
  host:
    - libboost {{ boost }}
    - thrift-cpp >=0.11
    # NOTE: 1.5.0 requires arrow-cpp > 0.10.0.  This is because the AllocateEmptyBitmap is not in 0.10.0
    - arrow-cpp >0.10.0
  run:
    - {{ pin_compatible("libboost", max_pin="x.x.x") }}

test:
  commands:
    - test -f $PREFIX/lib/libparquet.so                                       # [linux]
    - test -f $PREFIX/lib/libparquet.dylib                                    # [osx]
    - test -f $PREFIX/include/parquet/api/reader.h                            # [unix]
    - if not exist %PREFIX%\\Library\\include\\parquet\\api\\reader.h exit 1  # [win]
    - if not exist %PREFIX%\\Library\\bin\\parquet.dll exit 1                 # [win]
    - if not exist %PREFIX%\\Library\\lib\\parquet.lib exit 1                 # [win]
    - if not exist %PREFIX%\\Library\\lib\\parquet_static.lib exit 1          # [win]

about:
  home: http://github.com/apache/parquet-cpp
  license: Apache 2.0
  summary: 'C++ libraries for the Apache Parquet file format'

extra:
  recipe-maintainers:
    - wesm
    - xhochy
    - leifwalsh
    - jreback
    - cpcloud
    - siddharthteotia
